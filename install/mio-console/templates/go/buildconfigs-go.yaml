apiVersion: mio.io/v1alpha1
kind: BuildConfig
metadata:
  name: go
  namespace: templates
spec:
  app: ""
  baseImage: {{ .Values.go.nodeImage }}
  cloneConfig:
    branch: {{ .Values.buildconfig.branch }}
    dstDir: /opt/app-root/src
    password: ""
    url: {{ .Values.git.url }}
    username: ""
  cloneType: ""
  codeType: go
  compileCmd:
  - commandName: pwd
  - Script: GOOS=linux go build -o app
    execType: script
  - commandName: pwd
  - Script: ls
    execType: script
  deployData:
    envs:
      CODE_TYPE: go
      DOCKER_API_VERSION: "1.24"
      GOPROXY: {{ .Values.go.goProxy }}
    hostPathVolume:
      /var/lib/docker: /var/lib/docker
      /var/run/docker.sock: /var/run/docker.sock
    ports:
    - 8080
    - 7575
    replicas: 1
  dockerAuthConfig:
    password: {{ .Values.docker.password }}
    username: {{ .Values.docker.username }}
  dockerFile:
  - FROM {{ .Values.go.baseImage }}
  - ENV  TZ="Asia/Shanghai"
  - USER 0
  - RUN  useradd -u 1002 -r -g 0 -d ${HOME} -s /sbin/nologin -c "Default Application
    User" java
  - COPY ./app.jar ${HOME}
  - RUN chown -R 1001:0 ${HOME}
  - USER 1002
  - EXPOSE 8080
  - EXPOSE 7575
  - CMD ["./app"]
  dockerRegistry: {{ .Values.docker.registy }}
  nodeService: ""
  tasks:
  - name: createService
  - name: deployNode
  - name: clone
  - name: compile
  - name: buildImage
  - name: pushImage
  - name: deleteDeployment
status:
  lastVersion: 1

